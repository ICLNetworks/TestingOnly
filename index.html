<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Compressor Machi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        padding: 20px;
    }

    .drop-zone {
        border: 3px dashed #999;
        padding: 30px;
        text-align: center;
        background: #fff;
        border-radius: 10px;
        cursor: pointer;
    }

    .drop-zone.dragover {
        border-color: #4CAF50;
        background: #eaffea;
    }

    .item {
        background: #fff;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        display: flex;
        gap: 15px;
        align-items: center;
        border: 1px solid #ddd;
    }

    .thumb {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .btn {
        padding: 10px 18px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
    }

    .btn.secondary { background: #555; }
    .btn.small { padding: 6px 10px; font-size: 13px; }
    .btn.blue { background: #0b79d0; }

    /* Modal */
    .modal {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.88);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 25px;
        z-index: 2000;
    }

    .modal-content {
        background: #000;
        padding: 20px;
        border-radius: 8px;
        max-width: 95%;
    }

    /* Compare Area (Vertical Stack) */
    .compare-container {
        width: 900px;
        max-width: 100%;
        background: #111;
        border-radius: 10px;
        padding: 12px;
    }

    .compare-block {
        margin-bottom: 12px;
        text-align: center;
        color: #eee;
        font-size: 15px;
        font-weight: bold;
    }

    .compare-img {
        width: 100%;
        height: 380px;
        background: #000;
        object-fit: contain;
        border-radius: 6px;
        margin-bottom: 20px;
    }

    @media(max-width:600px){
        .compare-img { height: 260px; }
    }

</style>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

</head>
<body>

<h2>Image Compressor Machi ðŸ”¥</h2>

<div id="dropZone" class="drop-zone">
    <p>Drag & drop images here OR click<br><br>ðŸ“¸</p>
    <input type="file" id="fileInput" multiple accept="image/*" hidden>
</div>

<div id="list"></div>

<br>

<div style="display:flex; gap:10px;">
    <button id="compressAllBtn" class="btn">Compress All</button>
    <button id="zipAllBtn" class="btn secondary">ZIP All</button>
    <button id="clearBtn" class="btn secondary">Clear</button>
</div>


<!-- Compare Modal -->
<div id="compareModal" class="modal">
    <div class="modal-content">

        <div class="compare-container">

            <div class="compare-block">Original</div>
            <img id="compareOriginal" class="compare-img">

            <div class="compare-block">Compressed</div>
            <img id="compareCompressed" class="compare-img">

        </div>

        <button onclick="closeCompare()" class="btn secondary small">Close</button>
    </div>
</div>


<script>
let items = [];
const $ = id => document.getElementById(id);

/* =======================
   DRAG + DROP
======================= */
const dz = $("dropZone");
dz.onclick = () => $("fileInput").click();

dz.ondragover = e => { e.preventDefault(); dz.classList.add("dragover"); }
dz.ondragleave = () => dz.classList.remove("dragover");

dz.ondrop = e => {
    e.preventDefault();
    dz.classList.remove("dragover");
    handleFiles(e.dataTransfer.files);
};

$("fileInput").onchange = () => handleFiles($("fileInput").files);

function handleFiles(files){
    [...files].forEach(f => addItem(f));
}

/* =======================
   ADD ITEM
======================= */
function addItem(file){
    const reader = new FileReader();
    reader.onload = e => {
        items.push({
            file,
            name: file.name.replace(/\.[^.]+$/, ""),
            preview: e.target.result,
            originalSize: file.size,
            compressed: null,
            compressedSize: null
        });
        render();
    };
    reader.readAsDataURL(file);
}

function render(){
    $("list").innerHTML = "";
    items.forEach((it,i)=>{
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
            <img class="thumb" src="${it.preview}">
            <div style="flex:1;">
                <b>${it.name}</b><br>
                Original: ${(it.originalSize/1024).toFixed(1)} KB<br>
                ${it.compressed ? `Compressed: ${(it.compressedSize/1024).toFixed(1)} KB` : ""}
            </div>
            <button class="btn small" onclick="compressOne(${i})">Compress</button>
            ${it.compressed ? `<button class="btn small blue" onclick="showCompare(${i})">Compare</button>` : ""}
        `;
        $("list").appendChild(row);
    });
}

/* =======================
   COMPRESS
======================= */
function compressOne(i){
    const it = items[i];

    const img = new Image();
    img.src = it.preview;
    img.onload = () => {
        const c = document.createElement("canvas");
        c.width = img.width;
        c.height = img.height;
        c.getContext("2d").drawImage(img,0,0);

        const out = c.toDataURL("image/jpeg",0.6);

        it.compressed = out;
        it.compressedSize = Math.round(out.length * 0.75);

        render();
    };
}

$("compressAllBtn").onclick = () => {
    items.forEach((_,i)=>compressOne(i));
};

/* =======================
   COMPARE MODAL
======================= */
function showCompare(i){
    const it = items[i];

    $("compareOriginal").src = it.preview;
    $("compareCompressed").src = it.compressed;

    $("compareModal").style.display = "flex";
}

function closeCompare(){
    $("compareModal").style.display = "none";
}

/* =======================
   ZIP ALL
======================= */
$("zipAllBtn").onclick = async () => {
    const list = items.filter(i => i.compressed);
    if(!list.length){
        alert("Compress first machi!");
        return;
    }

    const zip = new JSZip();
    for(const it of list){
        const blob = await fetch(it.compressed).then(r=>r.blob());
        zip.file(it.name + "_compressed.jpg", blob);
    }

    const out = await zip.generateAsync({type:"blob"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(out);
    a.download = "compressed_images.zip";
    a.click();
};

/* =======================
   CLEAR
======================= */
$("clearBtn").onclick = () => {
    items = [];
    render();
};
</script>

</body>
</html>

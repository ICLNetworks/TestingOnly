<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Compressor Machi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        padding: 20px;
    }

    .drop-zone {
        border: 3px dashed #999;
        padding: 30px;
        text-align: center;
        background: #fff;
        border-radius: 10px;
        cursor: pointer;
    }

    .drop-zone.dragover {
        border-color: #4CAF50;
        background: #eaffea;
    }

    .item {
        background: #fff;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        display: flex;
        gap: 15px;
        align-items: center;
        border: 1px solid #ddd;
    }

    .thumb {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .btn {
        padding: 10px 18px;
        background: #4CAF50;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
    }

    .btn.secondary {
        background: #555;
    }

    .btn.small {
        padding: 6px 10px;
        font-size: 13px;
    }

    .btn.blue {
        background: #0b79d0;
    }

    /* MODAL */
    .modal {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.88);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 30px;
        z-index: 2000;
    }

    .modal-content {
        position: relative;
        background: #000;
        padding: 20px;
        border-radius: 8px;
        max-width: 95%;
    }

    /* Compare Buttons Top-Right */
    .compare-buttons {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 8px;
        z-index: 30;
    }

    /* FIXED Compare Area */
    .compare-img-container {
        position: relative;
        width: 900px;
        height: 500px;
        background: #111;
        overflow: hidden;
        border-radius: 8px;
    }

    .compare-img-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* Hover Fade Mode */
    #hoverContainer img {
        position: absolute;
        top: 0; left: 0;
        transition: opacity 0.3s ease;
    }
    #hoverContainer .top:hover {
        opacity: 0;
    }

    /* Side-by-Side Mode */
    #sideBySideContainer {
        display: none;
        height: 100%;
        width: 100%;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>

<h2>Image Compressor Machi ðŸ”¥</h2>

<div id="dropZone" class="drop-zone">
    <p>Drag & drop images here OR click<br><br>ðŸ“¸</p>
    <input type="file" id="fileInput" multiple accept="image/*" style="display:none;">
</div>

<div id="list"></div>

<br>

<div style="display:flex; gap:10px;">
    <button id="compressAllBtn" class="btn">Compress All</button>
    <button id="zipAllBtn" class="btn secondary">ZIP All</button>
    <button id="clearBtn" class="btn secondary">Clear</button>
</div>


<!-- Compare Modal -->
<div id="compareModal" class="modal">
    <div class="modal-content">

        <!-- Compare Buttons Top Right (C2) -->
        <div class="compare-buttons">
            <button id="btnHover" class="btn small blue">Hover Fade</button>
            <button id="btnSide" class="btn small">Side-by-Side</button>
        </div>

        <div class="compare-img-container">

            <!-- Hover Fade -->
            <div id="hoverContainer">
                <img id="compareOriginal" class="bottom">
                <img id="compareCompressed" class="top">
            </div>

            <!-- Side-by-side -->
            <div id="sideBySideContainer">
                <img id="sideOriginal">
                <img id="sideCompressed">
            </div>

        </div>

        <br>
        <button onclick="closeCompare()" class="btn secondary small">Close</button>
    </div>
</div>


<script>
let items = [];

function $(id){ return document.getElementById(id); }

/* ======================
   DRAG & DROP
====================== */
const dz = $("dropZone");
dz.onclick = () => $("fileInput").click();

dz.ondragover = e => { e.preventDefault(); dz.classList.add("dragover"); }
dz.ondragleave = () => dz.classList.remove("dragover");

dz.ondrop = e => {
    e.preventDefault();
    dz.classList.remove("dragover");
    handleFiles(e.dataTransfer.files);
};

$("fileInput").onchange = () => handleFiles($("fileInput").files);

function handleFiles(files){
    [...files].forEach(file => addItem(file));
}

/* ======================
   ADD ITEM
====================== */
function addItem(file){
    const reader = new FileReader();
    reader.onload = e => {
        const obj = {
            file,
            name: file.name.replace(/\.[^.]+$/, ""),
            originalSize: file.size,
            preview: e.target.result,
            compressed: null,
            compressedSize: null
        };
        items.push(obj);
        render();
    }
    reader.readAsDataURL(file);
}

function render(){
    $("list").innerHTML = "";
    items.forEach((it,i)=>{
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
            <img class="thumb" src="${it.preview}">
            <div style="flex:1;">
                <b>${it.name}</b><br>
                Original: ${(it.originalSize/1024).toFixed(1)} KB<br>
                ${it.compressed ? `Compressed: ${(it.compressedSize/1024).toFixed(1)} KB` : ""}
            </div>
            <button class="btn small" onclick="compressOne(${i})">Compress</button>
            ${it.compressed ? `<button class="btn small blue" onclick="showCompare(${i})">Compare</button>` : ""}
        `;
        $("list").appendChild(row);
    });
}

/* ======================
   COMPRESS ONE
====================== */
function compressOne(index){
    const it = items[index];

    const img = new Image();
    img.src = it.preview;
    img.onload = () => {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = img.width;
        canvas.height = img.height;

        ctx.drawImage(img,0,0);

        const compressed = canvas.toDataURL("image/jpeg", 0.6);
        it.compressed = compressed;

        it.compressedSize = Math.round((compressed.length * 3 / 4));

        render();
    };
}

$("compressAllBtn").onclick = () => {
    items.forEach((_,i)=>compressOne(i));
};

/* ======================
   COMPARE MODAL
====================== */
function showCompare(i){
    const it = items[i];

    $("compareOriginal").src = it.preview;
    $("compareCompressed").src = it.compressed;

    $("sideOriginal").src = it.preview;
    $("sideCompressed").src = it.compressed;

    // default mode
    showHover();

    $("compareModal").style.display = "flex";
}

function closeCompare(){
    $("compareModal").style.display = "none";
}

/* ===== Toggle Modes ===== */
function showHover(){
    $("hoverContainer").style.display = "block";
    $("sideBySideContainer").style.display = "none";

    $("btnHover").classList.add("blue");
    $("btnSide").classList.remove("blue");
}

function showSide(){
    $("hoverContainer").style.display = "none";
    $("sideBySideContainer").style.display = "grid";

    $("btnHover").classList.remove("blue");
    $("btnSide").classList.add("blue");
}

$("btnHover").onclick = showHover;
$("btnSide").onclick = showSide;

/* ======================
   ZIP ALL
====================== */
$("zipAllBtn").onclick = async () => {
    const compressedItems = items.filter(it => it.compressed);

    if(compressedItems.length === 0){
        alert("Compress images first machi!");
        return;
    }

    const zip = new JSZip();

    for(const it of compressedItems){
        const blob = await fetch(it.compressed).then(r=>r.blob());
        zip.file(it.name + "_compressed.jpg", blob);
    }

    const content = await zip.generateAsync({type:"blob"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(content);
    a.download = "compressed_images.zip";
    a.click();
};

/* ======================
   CLEAR
====================== */
$("clearBtn").onclick = () => {
    items = [];
    render();
};
</script>

</body>
</html>
